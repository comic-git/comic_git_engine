on:
  workflow_dispatch:
    branches:
      - working


jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Load repository
        uses: actions/checkout@v2
      - name: Update "latest" branch
        run: |
          git fetch --all
          git checkout latest
          git reset --hard origin/master
          git push -f
      - name: Update revision branch
        run: |
          export ENGINE_VERSION=$(sed -n 's/VERSION = "\(.*\..*\..*\)"/\1/p' scripts/build_site.py)
          echo "Engine version: $ENGINE_VERSION"
          git checkout -b $ENGINE_VERSION
          git reset --hard origin/master
          git merge master
          git push -f --set-upstream origin $ENGINE_VERSION
      - name: Update minor version branch
        run: |
          export ENGINE_VERSION=$(sed -n 's/VERSION = "\(.*\..*\)\..*"/\1/p' scripts/build_site.py)
          echo "Engine version: $ENGINE_VERSION"
          git checkout -b $ENGINE_VERSION
          git reset --hard origin/master
          git push -f --set-upstream origin $ENGINE_VERSION
